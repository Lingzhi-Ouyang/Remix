# Remix

This is the artifact (demo) of "Multi-Grained Specifications for Distributed System Model Checking and Verification" presented at EuroSys'25.

**Remix** is a tooling support for the verification using multi-grained specifications. It interfaces the TLC model checker, and provides conformance checking and deterministic execution of model-level traces.



## Overview

### Folder Structure

```
root
|---- apache-zookeeper-3.9.1			(Source code: target distributed system)
|---- checker					(Source code: the checker that replays model-level traces in implementation)

|---- generator					(Model-level scripts: generating model-level traces and parsing format)
	|---- Zab-simulate.ini	    		(Configurations for the model checking)
	|---- generate_traces.sh	    	(Generate model-level traces (raw data) using TLC. Output in the "output" directory)
	|---- read_traces.sh			(Parse trace format for later processing. Output in the "traces" directory)
	|---- read_latest_traces.sh 		(Parse the traces whose directory name has the latest suffix.Output in the "traces" directory)
	|---- run.sh				(generate_traces.sh && read_latest_traces.sh)
|---- scripts					(Code-level scripts: building the checker and conducting the trace replay)
	|---- build.sh			    	(Build the checker)
	|---- replay.sh				(Replay given traces in the implementation. Output in the "results" directory)
	|---- buildAndReplay.sh     		(build.sh && replay.sh <traces>)
	|---- checkAndReplay.sh	    		(Generate traces, parse and replay them in the implementation.
							Pre-requisite: the checker has already been built before)
	|---- stop.sh				(Directly kill all currently running zookeeper processes)
			
|---- output					(Data dir: Model-checking results and statistics generated by TLC)
	|---- *.csv				(Summary of the model checking results)
	|---- traces in raw data		(Sequences of states generated by TLC)
|---- traces					(Data dir: Model-level traces in multiple formats for later processing)
	|---- mck trace dir 			(A batch of traces generated from model checking)
		|---- * (no suffix)	    	(Raw data of traces generated by TLC)
		|---- *.json			(The input file for the checker)
		|---- *.txt			(A format with high readability)
|---- results					(Data dir: Results of replay)
	|---- mck trace result dir 		(Results of a batch of traces)
		|---- *.out			(Log for debugging)
		|---- matchReport		(Report on whether any discrepancy has been found)
		|---- trace results		(Results for each trace)
			|---- execution	    	(event sequence that has been walked)
			|---- statistics    	(Checking results of each step)
			|---- nodes		(Runtime data for each node, e.g., conf, data, log, etc)
```



### Pre-requisites for use

* Java 11+
* Python 3+
* [Apache Maven](http://maven.apache.org/) 3.5+

## Quick Start

### Replay demo traces

Use the trace directory `demo`  as an example.

Build the checker:

```bash
cd scripts
./build.sh 
```

Replay the traces:

```bash
./replay.sh demo 		
```

Or directly use the following script:

```bash
./buildAndReplay.sh demo 		
```

It is expected to output a corresponding result directory `results/demo_replay_<time>`. 
An expected `matchReport` would be like:

```
TOTAL: 3
UNMATCH:	0	MATCH:	3	UNMATCHED RATE:	0.0
```

### Generate traces and replay
Generate model-level traces and replay them:
```bash
cd scripts
./checkAndReplay.sh    # Pre-requisites: run ./build.sh first if not built before
```

Or do it step by step:
```bash
./generator/run.sh      # Find the <output_traces> in the "traces" directory
./scripts/replay.sh <output_traces>  # Pre-requisites: run ./scripts/build.sh first if not built before
```

It is expected to randomly generate three new traces (in the `traces/model_random_<gen_time>_output` directory) and output a corresponding result directory `results/model_random_<gen_time>_output_replay_<replay_time>`.
Normally, all the three traces are successfully replayed (for most of the time), and the `matchReport` would be like:

```
TOTAL: 3
UNMATCH:	0	MATCH:	3	UNMATCHED RATE:	0.0
```

In certain rare cases, some discrepancies might be detected, and the `matchReport` would be like:

```
TOTAL: 3
UNMATCH:	1	MATCH:	3	UNMATCHED RATE:	0.33
```

## Contributing

We appreciate all feedback and contributions. Please use Github issues for user questions and bug reports.
